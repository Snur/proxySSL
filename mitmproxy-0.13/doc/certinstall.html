<!DOCTYPE html>
<html>
    <head>
        <title>mitmproxy 0.13 - About Certificates</title>
        


<link  href="01-vendor.css" type="text/css" rel="StyleSheet"/>
<link  href="02-app.css" type="text/css" rel="StyleSheet"/>
<link  href="syntax.css" type="text/css" rel="StyleSheet"/>

    </head>
    <body>
        <div class="navbar navbar-default navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.html">
                        <img height="20px" src="mitmproxy-long.png"/>
                    </a>
                </div>
                <div class="navbar-header navbar-right">
                    <a class="navbar-brand" hre="#">0.13 docs</a>
                </div>
            </div>
        </div>


        <div class="container">
          <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-sidebar">
    <li><a href="index.html">Introduction</a></li>
    <li><a href="install.html">Installation</a></li>
    <li class="active"><a href="certinstall.html">About Certificates</a></li>
    <li><a href="howmitmproxy.html">How mitmproxy works</a></li>
    <li><a href="modes.html">Modes of Operation</a></li>

    <li class="nav-header">Tools</li>
        <li><a href="mitmproxy.html">mitmproxy</a></li>
        <li><a href="mitmdump.html">mitmdump</a></li>
        <li><a href="config.html">configuration</a></li>

    <li class="nav-header">Features</li>
        <li><a href="features/anticache.html">Anticache</a></li>

        <li><a href="features/filters.html">Filter expressions</a></li>
        <li><a href="features/replacements.html">Replacements</a></li>
        <li><a href="features/clientreplay.html">Client-side replay</a></li>
        <li><a href="features/serverreplay.html">Server-side replay</a></li>
        <li><a href="features/setheaders.html">Set Headers</a></li>
        <li><a href="features/passthrough.html">Ignore Domains</a></li>
        <li><a href="features/proxyauth.html">Proxy Authentication</a></li>
        <li><a href="features/reverseproxy.html">Reverse proxy mode</a></li>
        <li><a href="features/responsestreaming.html">Response Streaming</a></li>
        <li><a href="features/socksproxy.html">SOCKS Mode</a></li>
        <li><a href="features/sticky.html">Sticky cookies and auth</a></li>
        <li><a href="features/tcpproxy.html">TCP Proxy</a></li>
        <li><a href="features/upstreamproxy.html">Upstream proxy mode</a></li>
        <li><a href="features/upstreamcerts.html">Upstream Certs</a></li>


    <li class="nav-header">Transparent Proxying</li>
        <li><a href="transparent.html">Overview</a></li>
        <li><a href="transparent/linux.html">Linux</a></li>
        <li><a href="transparent/osx.html">OSX</a></li>

    <li class="nav-header">Scripting</li>
        <li><a href="scripting/inlinescripts.html">Inline Scripts</a></li>
        <li><a href="scripting/libmproxy.html">libmproxy</a></li>

    <li class="nav-header">Tutorials</li>
        <li><a href="tutorials/30second.html">Client playback: a 30 second example</a></li>
        <li><a href="tutorials/gamecenter.html">Setting highscores on Apple's GameCenter</a></li>
        <li><a href="tutorials/transparent-dhcp.html">Transparently proxify virtual machines</a></li>

    <li class="nav-header">Hacking</li>
        <li><a href="dev/architecture.html">Architecture</a></li>
        <li><a href="dev/testing.html">Testing</a></li>
        <li><a href="dev/sslkeylogfile.html">TLS Master Secrets</a></li>
</ul>

            </div>
            <div class="col-md-9">
                <div class="page-header">
                <h1>About Certificates</h1>
                </div>
                <h2>On This Page</h2>

<ul>
<li><a href="#docIntro">Introduction</a></li>
<li><a href="#docQuick">Quick Setup</a></li>
<li><a href="#docManual">Installing the mitmproxy CA certificate manually</a></li>
<li><a href="#docMore">More on mitmproxy certificates</a></li>
<li><a href="#docCertfiles">CA and cert files</a></li>
<li><a href="#docCustom">Using a custom certificate</a></li>
<li><a href="#docClient">Using a client side certificate</a></li>
<li><a href="#docCA">Using a custom certificate authority</a></li>
</ul>

<h2><a id="docIntro"></a>Introduction</h2>

<p>Mitmproxy can decrypt encrypted traffic on the fly, as long as the client
trusts its built-in certificate authority. Usually this means that the
mitmproxy CA certificates have to be installed on the client device.</p>

<h2><a id="docQuick"></a>Quick Setup</h2>

<p>By far the easiest way to install the mitmproxy certificates is to use the
built-in certificate installation app. To do this, just start mitmproxy and
configure your target device with the correct proxy settings. Now start a
browser on the device, and visit the magic domain <strong>mitm.it</strong>. You should see
something like this:</p>

<p><img class="img-responsive" src="certinstall-webapp.png" &gt;</img></p>

<p>Click on the relevant icon, and follow the setup instructions for the platform
you're on, and you are good to go.</p>

<h2><a id="docManual"></a>Installing the mitmproxy CA certificate manually</h2>

<p>Sometimes using the quick install app is not an option - Java or the IOS
similator spring to mind - or you just need to do it manually for some other
reason. Below is a list of pointers to manual certificate installation
documentation for some common platforms:</p>

<table class="table">
    <tr>
        <td><a href="https://github.com/ADVTOOLS/ADVTrustStore#how-to-use-advtruststore"</a>iOS Simulator</td>
        <td><a href="http://docs.oracle.com/cd/E19906-01/820-4916/geygn/index.html">Java</a></td>
    </tr>
    <tr>
        <td><a href="http://kb.mit.edu/confluence/pages/viewpage.action?pageId=152600377">iOS</a></td>
        <td><a href="http://wiki.cacert.org/FAQ/ImportRootCert#Android_Phones_.26_Tablets">Android/Android Simulator</a></td>
    </tr>

    <tr>
        <td><a href="http://windows.microsoft.com/en-ca/windows/import-export-certificates-private-keys#1TC=windows-7">Windows</a></td>
        <td><a href="https://support.apple.com/kb/PH7297?locale=en_US">Mac OS X</a></td>
    </tr>
    <tr>
        <td><a href="http://askubuntu.com/questions/73287/how-do-i-install-a-root-certificate/94861#94861">Ubuntu/Debian</a></td>
        <td><a href="https://wiki.mozilla.org/MozillaRootCertificate#Mozilla_Firefox">Firefox</a></td>
    </tr>
    <tr>
        <td><a href="https://code.google.com/p/chromium/wiki/LinuxCertManagement">Chrome on Linux</a></td>
    </tr>

</table>

<h2><a id="docMore"></a>More on mitmproxy certificates</h2>

<p>The first time <strong>mitmproxy</strong> or <strong>mitmdump</strong> is run, the mitmproxy Certificate
Authority(CA) is created in the config directory (~/.mitmproxy by default).
This CA is used for on-the-fly generation of dummy certificates for each of the
SSL sites that your client visits. Since your browser won't trust the
<strong>mitmproxy</strong> CA out of the box , you will see an SSL certificate warning every
time you visit a new SSL domain through <strong>mitmproxy</strong>. When you are testing a
single site through a browser, just accepting the bogus SSL cert manually is
not too much trouble, but there are a many circumstances where you will want to
configure your testing system or browser to trust the <strong>mitmproxy</strong> CA as a
signing root authority.</p>

<h2><a id="docCertfiles"></a>CA and cert files</h2>

<p>The files created by mitmproxy in the .mitmproxy directory are as follows:</p>

<table class="table">
    <tr>
        <td class="nowrap">mitmproxy-ca.pem</td>
        <td>The private key and certificate in PEM format.</td>
    </tr>
    <tr>
        <td class="nowrap">mitmproxy-ca-cert.pem</td>
        <td>The certificate in PEM format. Use this to distribute to most
        non-Windows platforms.</td>
    </tr>
    <tr>
        <td class="nowrap">mitmproxy-ca-cert.p12</td>
        <td>The certificate in PKCS12 format. For use on Windows.</td>
    </tr>
    <tr>
        <td class="nowrap">mitmproxy-ca-cert.cer</td>
        <td>Same file as .pem, but with an extension expected by some Android
        devices.</td>
    </tr>
</table>

<h2><a id="docCustom"></a>Using a custom certificate</h2>

<p>You can use your own certificate by passing the <kbd>--cert</kbd> option to
mitmproxy. mitmproxy then uses the provided certificate for interception of the
specified domains instead of generating a certificate signed by its own CA.</p>

<p>The certificate file is expected to be in the PEM format.  You can include
intermediary certificates right below your leaf certificate, so that you PEM
file roughly looks like this:</p>

<pre>
-----BEGIN PRIVATE KEY-----
&lt;private key&gt;
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
&lt;cert&gt;
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
&lt;intermediary cert (optional)&gt;
-----END CERTIFICATE-----
</pre>

<p>For example, you can generate a certificate in this format using these instructions:</p>

<pre class="terminal">
$ openssl genrsa -out cert.key 2048
$ openssl req -new -x509 -key cert.key -out cert.crt
    (Specify the mitm domain as Common Name, e.g. *.google.com)
$ cat cert.key cert.crt > cert.pem
$ mitmproxy --cert=cert.pem
</pre>

<h2><a id="docClient"></a>Using a client side certificate</h2>

<p>You can use a client certificate by passing the <kbd>--client-certs
DIRECTORY</kbd> option to mitmproxy.  If you visit example.org, mitmproxy looks
for a file named example.org.pem in the specified directory and uses this as
the client cert. The certificate file needs to be in the PEM format and should
contain both the unencrypted private key and the certificate.</p>

<h2><a id="docCA"></a>Using a custom certificate authority</h2>

<p>By default, mitmproxy will use <samp>~/.mitmproxy/mitmproxy-ca.pem</samp> as
the certificate authority to generate certificates for all domains for which no
custom certificate is provided (see above). You can use your own certificate
authority by passing the <kbd>--confdir</kbd> option to mitmproxy. Mitmproxy
will then look for <samp>mitmproxy-ca.pem</samp> in the specified directory. If
no such file exists, it will be generated automatically.</p>

            </div>
          </div>
        </div>

        <div class="container">
          <hr>

          <footer>
            <p>© mitmproxy project, 2015</p>
          </footer>
        </div>
    </body>
</html>
