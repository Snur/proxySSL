<!DOCTYPE html>
<html>
    <head>
        <title>mitmproxy 0.13 - Reverse proxy mode</title>
        


<link  href="../01-vendor.css" type="text/css" rel="StyleSheet"/>
<link  href="../02-app.css" type="text/css" rel="StyleSheet"/>
<link  href="../syntax.css" type="text/css" rel="StyleSheet"/>

    </head>
    <body>
        <div class="navbar navbar-default navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="../index.html">
                        <img height="20px" src="../mitmproxy-long.png"/>
                    </a>
                </div>
                <div class="navbar-header navbar-right">
                    <a class="navbar-brand" hre="#">0.13 docs</a>
                </div>
            </div>
        </div>


        <div class="container">
          <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-sidebar">
    <li><a href="../index.html">Introduction</a></li>
    <li><a href="../install.html">Installation</a></li>
    <li><a href="../certinstall.html">About Certificates</a></li>
    <li><a href="../howmitmproxy.html">How mitmproxy works</a></li>
    <li><a href="../modes.html">Modes of Operation</a></li>

    <li class="nav-header">Tools</li>
        <li><a href="../mitmproxy.html">mitmproxy</a></li>
        <li><a href="../mitmdump.html">mitmdump</a></li>
        <li><a href="../config.html">configuration</a></li>

    <li class="nav-header">Features</li>
        <li><a href="anticache.html">Anticache</a></li>

        <li><a href="filters.html">Filter expressions</a></li>
        <li><a href="replacements.html">Replacements</a></li>
        <li><a href="clientreplay.html">Client-side replay</a></li>
        <li><a href="serverreplay.html">Server-side replay</a></li>
        <li><a href="setheaders.html">Set Headers</a></li>
        <li><a href="passthrough.html">Ignore Domains</a></li>
        <li><a href="proxyauth.html">Proxy Authentication</a></li>
        <li class="active"><a href="reverseproxy.html">Reverse proxy mode</a></li>
        <li><a href="responsestreaming.html">Response Streaming</a></li>
        <li><a href="socksproxy.html">SOCKS Mode</a></li>
        <li><a href="sticky.html">Sticky cookies and auth</a></li>
        <li><a href="tcpproxy.html">TCP Proxy</a></li>
        <li><a href="upstreamproxy.html">Upstream proxy mode</a></li>
        <li><a href="upstreamcerts.html">Upstream Certs</a></li>


    <li class="nav-header">Transparent Proxying</li>
        <li><a href="../transparent.html">Overview</a></li>
        <li><a href="../transparent/linux.html">Linux</a></li>
        <li><a href="../transparent/osx.html">OSX</a></li>

    <li class="nav-header">Scripting</li>
        <li><a href="../scripting/inlinescripts.html">Inline Scripts</a></li>
        <li><a href="../scripting/libmproxy.html">libmproxy</a></li>

    <li class="nav-header">Tutorials</li>
        <li><a href="../tutorials/30second.html">Client playback: a 30 second example</a></li>
        <li><a href="../tutorials/gamecenter.html">Setting highscores on Apple's GameCenter</a></li>
        <li><a href="../tutorials/transparent-dhcp.html">Transparently proxify virtual machines</a></li>

    <li class="nav-header">Hacking</li>
        <li><a href="../dev/architecture.html">Architecture</a></li>
        <li><a href="../dev/testing.html">Testing</a></li>
        <li><a href="../dev/sslkeylogfile.html">TLS Master Secrets</a></li>
</ul>

            </div>
            <div class="col-md-9">
                <div class="page-header">
                <h1>Reverse proxy mode</h1>
                </div>
                <p>In reverse proxy mode, mitmproxy accepts standard HTTP requests and forwards
them to the specified upstream server. This is in contrast to
<a href="upstreamproxy.html">upstream proxy mode</a>, in which
mitmproxy forwards HTTP proxy requests to an upstream proxy server.</p>

<table class="table">
    <tbody>
        <tr>
            <th width="20%">command-line</th> <td>-R <i>schema</i>://hostname[:port]</td>
        </tr>
    </tbody>
</table>

<p>Here, <strong>schema</strong> is one of http, https, http2https or https2http. The latter
two extended schema specifications control the use of HTTP and HTTPS on
mitmproxy and the upstream server. You can indicate that mitmproxy should use
HTTP, and the upstream server uses HTTPS like this:</p>

<pre><code>http2https://hostname:port
</code></pre>

<p>And you can indicate that mitmproxy should use HTTPS while the upstream
service uses HTTP like this:</p>

<pre><code>https2http://hostname:port
</code></pre>

<h3>Host Header</h3>

<p>In reverse proxy mode, mitmproxy does not rewrite the host header. While often useful, this
may lead to issues with public web servers. For example, consider the following scenario:</p>

<pre><code>$ python mitmdump -d -R http://example.com/ &amp;
$ curl http://localhost:8080/

&gt;&gt; GET https://example.com/
    Host: localhost:8080
    User-Agent: curl/7.35.0
    [...]

&lt;&lt; 404 Not Found 345B
</code></pre>

<p>Since the Host header doesn't match <samp>example.com</samp>, an error is returned.<br>
There are two ways to solve this:</p>

<ol>
    <li>Modify the hosts file of your OS so that example.com resolves to 127.0.0.1.</li>
    <li>
        Instruct mitmproxy to rewrite the host header by passing <kbd>&#8209;&#8209;setheader&nbsp;:~q:Host:example.com</kbd>.
        However, keep in mind that absolute URLs within the returned document or HTTP redirects will cause the client application
        to bypass the proxy.
    </li>
</ol>

            </div>
          </div>
        </div>

        <div class="container">
          <hr>

          <footer>
            <p>Â© mitmproxy project, 2015</p>
          </footer>
        </div>
    </body>
</html>
