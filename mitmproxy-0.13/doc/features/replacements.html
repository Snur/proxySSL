<!DOCTYPE html>
<html>
    <head>
        <title>mitmproxy 0.13 - Replacements</title>
        


<link  href="../01-vendor.css" type="text/css" rel="StyleSheet"/>
<link  href="../02-app.css" type="text/css" rel="StyleSheet"/>
<link  href="../syntax.css" type="text/css" rel="StyleSheet"/>

    </head>
    <body>
        <div class="navbar navbar-default navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="../index.html">
                        <img height="20px" src="../mitmproxy-long.png"/>
                    </a>
                </div>
                <div class="navbar-header navbar-right">
                    <a class="navbar-brand" hre="#">0.13 docs</a>
                </div>
            </div>
        </div>


        <div class="container">
          <div class="row">
            <div class="col-md-3">
                <ul class="nav nav-sidebar">
    <li><a href="../index.html">Introduction</a></li>
    <li><a href="../install.html">Installation</a></li>
    <li><a href="../certinstall.html">About Certificates</a></li>
    <li><a href="../howmitmproxy.html">How mitmproxy works</a></li>
    <li><a href="../modes.html">Modes of Operation</a></li>

    <li class="nav-header">Tools</li>
        <li><a href="../mitmproxy.html">mitmproxy</a></li>
        <li><a href="../mitmdump.html">mitmdump</a></li>
        <li><a href="../config.html">configuration</a></li>

    <li class="nav-header">Features</li>
        <li><a href="anticache.html">Anticache</a></li>

        <li><a href="filters.html">Filter expressions</a></li>
        <li class="active"><a href="replacements.html">Replacements</a></li>
        <li><a href="clientreplay.html">Client-side replay</a></li>
        <li><a href="serverreplay.html">Server-side replay</a></li>
        <li><a href="setheaders.html">Set Headers</a></li>
        <li><a href="passthrough.html">Ignore Domains</a></li>
        <li><a href="proxyauth.html">Proxy Authentication</a></li>
        <li><a href="reverseproxy.html">Reverse proxy mode</a></li>
        <li><a href="responsestreaming.html">Response Streaming</a></li>
        <li><a href="socksproxy.html">SOCKS Mode</a></li>
        <li><a href="sticky.html">Sticky cookies and auth</a></li>
        <li><a href="tcpproxy.html">TCP Proxy</a></li>
        <li><a href="upstreamproxy.html">Upstream proxy mode</a></li>
        <li><a href="upstreamcerts.html">Upstream Certs</a></li>


    <li class="nav-header">Transparent Proxying</li>
        <li><a href="../transparent.html">Overview</a></li>
        <li><a href="../transparent/linux.html">Linux</a></li>
        <li><a href="../transparent/osx.html">OSX</a></li>

    <li class="nav-header">Scripting</li>
        <li><a href="../scripting/inlinescripts.html">Inline Scripts</a></li>
        <li><a href="../scripting/libmproxy.html">libmproxy</a></li>

    <li class="nav-header">Tutorials</li>
        <li><a href="../tutorials/30second.html">Client playback: a 30 second example</a></li>
        <li><a href="../tutorials/gamecenter.html">Setting highscores on Apple's GameCenter</a></li>
        <li><a href="../tutorials/transparent-dhcp.html">Transparently proxify virtual machines</a></li>

    <li class="nav-header">Hacking</li>
        <li><a href="../dev/architecture.html">Architecture</a></li>
        <li><a href="../dev/testing.html">Testing</a></li>
        <li><a href="../dev/sslkeylogfile.html">TLS Master Secrets</a></li>
</ul>

            </div>
            <div class="col-md-9">
                <div class="page-header">
                <h1>Replacements</h1>
                </div>
                <p>Mitmproxy lets you specify an arbitrary number of patterns that define text
replacements within flows. Each pattern has 3 components: a filter that defines
which flows a replacement applies to, a regular expression that defines what
gets replaced, and a target value that defines what is substituted in.</p>

<p>Replace hooks fire when either a client request or a server response is
received. Only the matching flow component is affected: so, for example, if a
replace hook is triggered on server response, the replacement is only run on
the Response object leaving the Request intact. You control whether the hook
triggers on the request, response or both using the filter pattern. If you need
finer-grained control than this, it's simple to create a script using the
replacement API on Flow components. </p>

<p>Replacement hooks are extremely handy in interactive testing of applications.
For instance you can use a replace hook to replace the text "XSS" with a
complicated XSS exploit, and then "inject" the exploit simply by interacting
with the application through the browser. When used with tools like Firebug and
mitmproxy's own interception abilities, replacement hooks can be an amazingly
flexible and powerful feature. </p>

<h2>On the command-line</h2>

<p>The replacement hook command-line options use a compact syntax to make it easy
to specify all three components at once. The general form is as follows:</p>

<pre><code>/patt/regex/replacement
</code></pre>

<p>Here, <strong>patt</strong> is a mitmproxy filter expression, <strong>regex</strong> is a valid Python
regular expression, and <strong>replacement</strong> is a string literal. The first
character in the expression (<strong>/</strong> in this case) defines what the separation
character is. Here's an example of a valid expression that replaces "foo" with
"bar" in all requests:</p>

<pre><code>:~q:foo:bar
</code></pre>

<p>In practice, it's pretty common for the replacement literal to be long and
complex. For instance, it might be an XSS exploit that weighs in at hundreds or
thousands of characters. To cope with this, there's a variation of the
replacement hook specifier that lets you load the replacement text from a file.
So, you might start <strong>mitmdump</strong> as follows:</p>

<pre class="terminal">
mitmdump --replace-from-file :~q:foo:~/xss-exploit
</pre>

<p>This will load the replacement text from the file <strong>~/xss-exploit</strong>.</p>

<p>Both the <em>--replace</em> and <em>--replace-from-file</em> flags can be passed multiple
times.</p>

<h2>Interactively</h2>

<p>The <em>R</em> shortcut key in mitmproxy lets you add and edit replacement hooks using
a built-in editor. The context-sensitive help (<em>h</em>) has complete usage
information.</p>

<table class="table">
    <tbody>
        <tr>
            <th width="20%">command-line</th>
            <td>
                <ul>
                    <li>--replace</li>
                    <li>--replace-from-file</li>
                </ul>
            </td>
        </tr>
        <tr>
            <th>mitmproxy shortcut</th> <td><b>R</b></td>
        </tr>
    </tbody>
</table>

            </div>
          </div>
        </div>

        <div class="container">
          <hr>

          <footer>
            <p>Â© mitmproxy project, 2015</p>
          </footer>
        </div>
    </body>
</html>
